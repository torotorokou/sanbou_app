# 未実装エンドポイント一覧

## 概要

core_apiにおいて将来実装予定だが、現時点では未実装のエンドポイントの一覧です。
これらは主にledger_apiへのプロキシ機能として計画されています。

## 未実装エンドポイント

### 1. 顧客比較分析Excel出力

**ファイル:** `app/presentation/routers/analysis/router.py`

**エンドポイント:** `POST /analysis/customer-comparison/excel`

**機能:**

- 顧客比較分析結果をExcel形式でダウンロード
- ledger_apiへのプロキシ機能

**実装に必要な作業:**

1. ledger_api側に `/analysis/customer-comparison/excel` エンドポイントを実装
2. core_api側でプロキシ処理を実装
3. Excel生成ロジック（openpyxl等）をledger_apiに実装

**優先度:** 中

---

### 2. レポートExcel出力

**ファイル:** `app/presentation/routers/reports/router.py`

**エンドポイント:** `POST /reports/excel`

**機能:**

- レポート結果をExcel形式でダウンロード
- ledger_apiへのプロキシ機能

**実装に必要な作業:**

1. ledger_api側に `/reports/excel` エンドポイントを実装
2. core_api側でプロキシ処理を実装（FormData対応）
3. Excel生成ロジック（openpyxl等）をledger_apiに実装

**優先度:** 中

---

## 実装時の設計方針

### BFF責務の明確化

- **core_api (BFF):** HTTP I/O、認証・認可、ルーティング、レスポンス変換
- **ledger_api (Backend):** ビジネスロジック、DB操作、Excel生成

### プロキシパターン

```python
@router.post("/customer-comparison/excel")
async def proxy_customer_comparison_excel(request: Request):
    """顧客比較分析Excel出力（ledger_apiへフォワード）"""
    async with httpx.AsyncClient(timeout=60.0) as client:
        # 認証・認可チェック（将来実装）
        # current_user = Depends(get_current_user)

        # FormData/JSONをledger_apiへフォワード
        body = await request.json()
        r = await client.post(
            f"{LEDGER_API_BASE_URL}/analysis/customer-comparison/excel",
            json=body
        )
        r.raise_for_status()

        # Excelファイルをストリーミングレスポンスで返却
        return Response(
            content=r.content,
            media_type="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            headers={"Content-Disposition": "attachment; filename=report.xlsx"}
        )
```

---

## 削除されたコードの履歴

以下のコメントアウト部分は、このドキュメントへの移行により削除されました：

- `app/presentation/routers/analysis/router.py:121-148` (28行)
- `app/presentation/routers/reports/router.py:419-435` (17行)

将来実装時は、このドキュメントを参照してください。

---

**作成日:** 2025-11-27
**作成者:** AI Refactoring Agent
