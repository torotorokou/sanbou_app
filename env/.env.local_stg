###############################################
# .env.local_stg (ローカル STG 疑似: nginx + 本番近似構成 / HTTP のみ)
# - vm_stg (.env.stg) との差分: PUBLIC_BASE_URL と server_name 想定
# - hosts に 127.0.0.1 stg.local を追加して利用
###############################################

APP_TAG=local_stg
STAGE=stg
NODE_ENV=staging
PUBLIC_BASE_URL=http://stg.local

# === Security / Authentication ===
# ローカルSTG疑似環境では IAP 無効、DEBUG 無効（本番に近い設定）
DEBUG=false
IAP_ENABLED=false
IAP_AUDIENCE=

# === DB (stg と同一スキーマ名でパリティ) ===
# 【DB ユーザー分離対応】
# POSTGRES_USER / POSTGRES_PASSWORD / DATABASE_URL は secrets/.env.local_stg.secrets に記載してください
# 推奨: sanbou_app_stg ユーザーを使用（scripts/sql/20251204_create_app_db_users.sql 参照）
# 
# 注意: DATABASE_URL はパスワードを含むため、必ず secrets/ ファイルで設定してください
#       ここで設定すると Git にパスワードが記録されます
POSTGRES_DB=sanbou_stg

# === GCP 認証 (ADC) ===
# Application Default Credentials を使用
# ローカルでは 'gcloud auth application-default login'、
# GCE では VM にサービスアカウントをアタッチ
# GOOGLE_APPLICATION_CREDENTIALS 環境変数は不要です

# === RAG (rag_api) ===
# 優先される完全URI形式。例: gs://<bucket>/<service>/<object>/<prefix>/
RAG_GCS_URI=gs://sanbouapp-stg/rag_api/object_haikibutu/master/
# OPTIONAL: ローカル保存先を変えたい場合に上書き
# TARGET_DIR=/backend/local_data/master

# === ledger_api 同期 ===
STRICT_STARTUP=false
STARTUP_DOWNLOAD_ENABLE=True
GCS_LEDGER_BUCKET=
GCS_LEDGER_BUCKET_STG=gs://sanbouapp-stg/ledger_api/st_app
GCS_LEDGER_BUCKET_PROD=gs://sanbouapp-prod/ledger_api/st_app

# === Nginx exposed ports (衝突時は上書き可能) ===
STG_NGINX_HTTP_PORT=18080
STG_NGINX_HTTPS_PORT=18443

# === Forecast Worker Settings ===
# ローカルSTG環境では短い間隔でポーリング（.env.commonのデフォルトを上書き）
POLL_INTERVAL=3

# === メモ ===
# ・TLS は将来有効化 (stg.conf 内でコメントアウト済みセクション)
# ・サーバ名は stg.local 固定 (vm 側は stg.sanbou-app.jp)
# ・内部API URL (RAG_API_BASE等) は .env.common から継承
