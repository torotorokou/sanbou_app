###############################################
# .env.example (環境変数設定のテンプレート)
# - 実際の値は各環境の .env.<env> ファイルとシークレットファイルに設定してください
# - このファイルはGit管理されます。実際の秘密情報は記載しないでください
# - 新しい環境を作成する際の完全なテンプレートとして使用できます
###############################################

# === 環境設定の構成 ===
# .env.common                    : 全環境共通設定（Git管理）
# .env.<env>                     : 環境別設定（Git管理）
# secrets/.env.<env>.secrets     : パスワード・APIキー（Git管理外）
#
# 読み込み順序: .env.common → .env.<env> → secrets/.env.<env>.secrets
#
# 【重要】DB ユーザー分離対応について
# - POSTGRES_USER / POSTGRES_DB は各環境の .env.<env> ファイルに記載してください
# - POSTGRES_PASSWORD のみ secrets/.env.<env>.secrets に記載してください
# - 環境別の専用ユーザーを使用してください：
#   * 開発: sanbou_app_dev
#   * デモ: sanbou_app_demo
#   * ステージング: sanbou_app_stg
#   * 本番: sanbou_app_prod
# - DATABASE_URL は自動生成されます（URLエンコード対応）
# - 詳細は docs/db/20251204_db_user_design.md を参照

# ==== 共通設定 (.env.common から継承) ========================================
# これらの値は .env.common で定義されており、通常は環境別ファイルで上書きする必要はありません

# DB 接続（環境別に上書き）
# POSTGRES_USER は各環境の .env.<env> ファイルに記載
# POSTGRES_PASSWORD は secrets/.env.<env>.secrets ファイルに記載
POSTGRES_HOST=db
POSTGRES_PORT=5432

# アプリケーション基底設定
APP_ROOT_DIR=/backend
PYTHONPATH=${APP_ROOT_DIR}
APP_BASE_DIR=${APP_ROOT_DIR}
CORE_API_PYTHONPATH=${APP_ROOT_DIR}
FORECAST_WORKER_PYTHONPATH=/worker

# ledger_api 設定
BASE_ST_APP_DIR=${APP_ROOT_DIR}/app/st_app
LEDGER_SYNC_SUBDIRS=master,templates

# API エンドポイント（Docker Compose 内部通信）
RAG_API_BASE=http://rag_api:8000
LEDGER_API_BASE=http://ledger_api:8000
MANUAL_API_BASE=http://manual_api:8000
AI_API_BASE=http://ai_api:8000
CORE_API_INTERNAL_URL=http://core_api:8000

# セキュリティ設定（環境別に上書き）
DEBUG=false
IAP_ENABLED=false
IAP_AUDIENCE=
ALLOWED_EMAIL_DOMAIN=honest-recycle.co.jp
IAP_PUBLIC_KEY_URL=https://www.gstatic.com/iap/verify/public_key

# アプリケーション設定
APP_TIMEZONE=Asia/Tokyo
TZ=Asia/Tokyo

# 外部サービス API
GEMINI_API_URL=https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent

# ディレクトリパス
SECRETS_DIR=/backend/secrets
CSV_TEMP_DIR=/tmp/csv_uploads
CSV_MASTERS_YAML_PATH=/backend/config/csv_config/shogun_csv_masters.yaml

# アップロード制限
CSV_UPLOAD_MAX_SIZE=10485760

# CORS設定（環境別に上書き）
CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# Forecast Worker 設定（環境別に上書き可能）
POLL_INTERVAL=5

# API Keys（secrets ファイルで設定）
OPENAI_API_KEY=CHANGEME_YOUR_OPENAI_API_KEY
GEMINI_API_KEY=CHANGEME_YOUR_GEMINI_API_KEY

# レポート署名用シークレット（secrets ファイルで設定）
# 生成方法: openssl rand -base64 32
REPORT_ARTIFACT_SECRET=CHANGEME_STRONG_RANDOM_SECRET

# ==== 開発環境 (.env.local_dev) ==============================================
APP_TAG=local_dev
STAGE=dev
NODE_ENV=development
PUBLIC_BASE_URL=http://localhost:5173

# DB 接続
POSTGRES_USER=sanbou_app_dev
POSTGRES_DB=sanbou_dev
# POSTGRES_PASSWORD は secrets/.env.local_dev.secrets に記載
# DATABASE_URL は自動生成されます（URLエンコード対応）

# セキュリティ
DEBUG=true
IAP_ENABLED=false
IAP_AUDIENCE=

# GCS 同期
STARTUP_DOWNLOAD_ENABLE=false
STRICT_STARTUP=false
GCS_LEDGER_BUCKET=
GCS_LEDGER_BUCKET_DEV=gs://sanbouapp-dev/ledger_api/st_app
GCS_LEDGER_BUCKET_STG=gs://sanbouapp-stg/ledger_api/st_app
GCS_LEDGER_BUCKET_PROD=gs://sanbouapp-prod/ledger_api/st_app

# 開発用ポート
DEV_FRONTEND_PORT=5173
DEV_AI_API_PORT=8001
DEV_LEDGER_API_PORT=8002
DEV_CORE_API_PORT=8003
DEV_RAG_API_PORT=8004
DEV_MANUAL_API_PORT=8005
DEV_DB_PORT=5432

# Frontend 設定（deprecated）
VITE_API_BASE_URL=/core_api

# Worker 設定
POLL_INTERVAL=3

# FS Watcher
CHOKIDAR_USEPOLLING=true

# ==== ローカルデモ環境 (.env.local_demo) =====================================
# APP_TAG=local_demo
# STAGE=demo
# NODE_ENV=development
# PUBLIC_BASE_URL=http://localhost:5174
# POSTGRES_USER=sanbou_app_demo
# POSTGRES_DB=sanbou_demo
# DEV_FRONTEND_PORT=5174
# DEV_AI_API_PORT=8011
# DEV_LEDGER_API_PORT=8012
# DEV_CORE_API_PORT=8013
# DEV_RAG_API_PORT=8014
# DEV_MANUAL_API_PORT=8015
# DEV_DB_PORT=5433

# ==== ローカルSTG環境 (.env.local_stg) =======================================
# APP_TAG=local_stg
# STAGE=stg
# NODE_ENV=staging
# PUBLIC_BASE_URL=http://stg.local
# POSTGRES_USER=sanbou_app_stg
# POSTGRES_DB=sanbou_stg
# DEBUG=false
# IAP_ENABLED=false
# STARTUP_DOWNLOAD_ENABLE=True
# STRICT_STARTUP=false
# RAG_GCS_URI=gs://sanbouapp-stg/rag_api/object_haikibutu/master/
# STG_NGINX_HTTP_PORT=18080
# STG_NGINX_HTTPS_PORT=18443
# POLL_INTERVAL=3

# ==== VM STG環境 (.env.vm_stg) ===============================================
# APP_TAG=stg
# STAGE=stg
# NODE_ENV=staging
# PUBLIC_BASE_URL=https://stg.sanbou-app.jp
# POSTGRES_USER=sanbou_app_stg
# POSTGRES_DB=sanbou_stg
# DEBUG=false
# IAP_ENABLED=true
# IAP_AUDIENCE=/projects/PROJECT_NUMBER/global/backendServices/SERVICE_ID
# STARTUP_DOWNLOAD_ENABLE=True
# STRICT_STARTUP=false
# RAG_GCS_URI=gs://sanbouapp-stg/rag_api/object_haikibutu/master/
# STG_NGINX_HTTP_PORT=8080
# STG_NGINX_HTTPS_PORT=8443

# ==== VM 本番環境 (.env.vm_prod) =============================================
# APP_TAG=prod
# STAGE=prod
# NODE_ENV=production
# PUBLIC_BASE_URL=https://sanbou-app.jp
# POSTGRES_USER=sanbou_app_prod
# POSTGRES_DB=sanbou_prod
# DEBUG=false
# IAP_ENABLED=true
# IAP_AUDIENCE=/projects/PROJECT_NUMBER/global/backendServices/SERVICE_ID
# RAG_GCS_URI=
# STARTUP_DOWNLOAD_ENABLE=
# STRICT_STARTUP=false
# POLL_INTERVAL=10

# ==== 参考資料 ===============================================================
# ・環境変数スキーマの基準: env/.env.local_dev
# ・DB ユーザー設計: docs/db/20251204_db_user_design.md
# ・移行手順: docs/db/20251204_db_user_migration_plan.md
# ・SQL スクリプト: scripts/sql/20251204_create_app_db_users.sql
# ・GCP 認証: Application Default Credentials (ADC) を使用
#   - ローカル: gcloud auth application-default login
#   - GCE: VM にサービスアカウントをアタッチ
