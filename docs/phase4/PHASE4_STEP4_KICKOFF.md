# Phase 4 Step 4: Databaseæ©Ÿèƒ½ã®ç§»è¡Œ

**ä½œæˆæ—¥**: 2025-01-05  
**Phase**: 4  
**Step**: 4  
**æ‹…å½“**: Migration Team

---

## ğŸ“‹ æ¦‚è¦

**ç›®çš„**: Databaseæ©Ÿèƒ½ã‚’Feature-Sliced Designæ§‹é€ ã«å®Œå…¨ç§»è¡Œ

**èƒŒæ™¯**: 
- Phase 4 Step 3ã§Reportæ©Ÿèƒ½ã®ç§»è¡Œã‚’å®Œäº†
- Reportã§ç¢ºç«‹ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨
- Databaseæ©Ÿèƒ½ã¯CSVã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»æ¤œè¨¼ãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’æä¾›

**ã‚¹ã‚³ãƒ¼ãƒ—**:
- UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (4ãƒ•ã‚¡ã‚¤ãƒ«)
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ•ãƒƒã‚¯ (3ãƒ•ã‚¡ã‚¤ãƒ«)
- å‹å®šç¾© (1ãƒ•ã‚¡ã‚¤ãƒ«)
- åˆè¨ˆ: 8ãƒ•ã‚¡ã‚¤ãƒ«

---

## ğŸ¯ ç›®æ¨™

### ä¸»è¦ç›®æ¨™
1. **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç§»è¡Œ**: `components/database/` â†’ `features/database/ui/`
2. **ãƒ•ãƒƒã‚¯ã®ç§»è¡Œ**: `hooks/database/` â†’ `features/database/hooks/`
3. **å‹å®šç¾©ã®ç§»è¡Œ**: `components/database/types.ts` â†’ `features/database/model/`
4. **å…¬é–‹APIä½œæˆ**: `features/database/index.ts`
5. **ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼æ›´æ–°**: `UploadDatabasePage.tsx`

### å‰¯æ¬¡çš„ç›®æ¨™
- ãƒ“ãƒ«ãƒ‰æ™‚é–“ã®ç¶­æŒ (< 10ç§’)
- å‹ã‚¨ãƒ©ãƒ¼0ä»¶
- æ˜ç¢ºãªAPIå¢ƒç•Œã®ç¢ºç«‹

---

## ğŸ“Š ç¾çŠ¶åˆ†æ

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

**ç¾åœ¨ã®é…ç½®**:
```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ database/
â”‚       â”œâ”€â”€ CsvPreviewCard.tsx       # CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
â”‚       â”œâ”€â”€ CsvUploadPanel.tsx       # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UI
â”‚       â”œâ”€â”€ UploadInstructions.tsx   # ä½¿ç”¨æ–¹æ³•èª¬æ˜
â”‚       â””â”€â”€ types.ts                 # å‹å®šç¾©
â””â”€â”€ hooks/
    â””â”€â”€ database/
        â”œâ”€â”€ index.ts                 # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        â”œâ”€â”€ useCsvUploadArea.ts      # ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
        â””â”€â”€ useCsvUploadHandler.ts   # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
```

**ç§»è¡Œå¾Œã®é…ç½®**:
```
src/features/database/
â”œâ”€â”€ model/
â”‚   â””â”€â”€ database.types.ts           # å‹å®šç¾©
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useCsvUploadArea.ts
â”‚   â”œâ”€â”€ useCsvUploadHandler.ts
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ CsvPreviewCard.tsx
â”‚   â”œâ”€â”€ CsvUploadPanel.tsx
â”‚   â””â”€â”€ UploadInstructions.tsx
â””â”€â”€ index.ts                        # å…¬é–‹API
```

### ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼åˆ†æ

**å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«** (1ãƒ•ã‚¡ã‚¤ãƒ«):
1. `pages/database/UploadDatabasePage.tsx`
   - `UploadInstructions` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   - `useCsvUploadHandler` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
   - `useCsvUploadArea` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

**ä¾å­˜é–¢ä¿‚**:
- `@shared/hooks/ui` (å…±æœ‰UIãƒ•ãƒƒã‚¯)
- `@shared/utils` (ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã€CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼)
- `@shared/infrastructure/http` (HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)

---

## ğŸ“ å®Ÿæ–½è¨ˆç”»

### Step 4-1: å‹å®šç¾©ã®ç§»è¡Œ âœ… (æœ€åˆ)

**ç†ç”±**: ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‹å®šç¾©ã«ä¾å­˜

**ã‚¿ã‚¹ã‚¯**:
- [ ] `types.ts` ã‚’ `features/database/model/database.types.ts` ã«ã‚³ãƒ”ãƒ¼
- [ ] ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ç¢ºèª (å†…éƒ¨ä¾å­˜ãªã—æƒ³å®š)
- [ ] å…¬é–‹APIã«è¿½åŠ 
- [ ] ãƒ“ãƒ«ãƒ‰ç¢ºèª

**äºˆæƒ³æ™‚é–“**: 10åˆ†

---

### Step 4-2: ãƒ•ãƒƒã‚¯ã®ç§»è¡Œ

**ç†ç”±**: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒ•ãƒƒã‚¯ã«ä¾å­˜

**ã‚¿ã‚¹ã‚¯**:
- [ ] `hooks/database/` ã‚’ `features/database/hooks/` ã«ã‚³ãƒ”ãƒ¼ (3ãƒ•ã‚¡ã‚¤ãƒ«)
- [ ] å†…éƒ¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ä¿®æ­£
  - ç›¸å¯¾ãƒ‘ã‚¹ `./` ç¶­æŒ
  - å‹å®šç¾©: `@features/database` ã‹ã‚‰å‚ç…§
  - å…±æœ‰ãƒ•ãƒƒã‚¯: `@shared/hooks/ui` ä½¿ç”¨
- [ ] å…¬é–‹APIã«è¿½åŠ  (3ãƒ•ãƒƒã‚¯)
- [ ] ãƒ“ãƒ«ãƒ‰ç¢ºèª

**äºˆæƒ³æ™‚é–“**: 20åˆ†

---

### Step 4-3: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç§»è¡Œ

**ç†ç”±**: æœ€å¾Œã«UIã‚’ç§»è¡Œ

**ã‚¿ã‚¹ã‚¯**:
- [ ] `components/database/` ã‚’ `features/database/ui/` ã«ã‚³ãƒ”ãƒ¼ (3ãƒ•ã‚¡ã‚¤ãƒ«)
- [ ] å†…éƒ¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ä¿®æ­£
  - æ—¢ç§»è¡Œãƒ•ãƒƒã‚¯: `@features/database` ã‹ã‚‰å‚ç…§
  - å…±æœ‰UI: `@shared/ui` ä½¿ç”¨
  - å‹å®šç¾©: `@features/database` ã‹ã‚‰å‚ç…§
- [ ] å…¬é–‹APIã«è¿½åŠ  (3ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
- [ ] ãƒ“ãƒ«ãƒ‰ç¢ºèª

**äºˆæƒ³æ™‚é–“**: 20åˆ†

---

### Step 4-4: ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼æ›´æ–°

**ã‚¿ã‚¹ã‚¯**:
- [ ] `UploadDatabasePage.tsx` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ›´æ–°
  - `@/components/database/` â†’ `@features/database`
  - `@/hooks/database/` â†’ `@features/database`
- [ ] ãƒ“ãƒ«ãƒ‰ç¢ºèª
- [ ] æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ

**äºˆæƒ³æ™‚é–“**: 10åˆ†

---

### Step 4-5: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

**ã‚¿ã‚¹ã‚¯**:
- [ ] `PHASE4_STEP4_COMPLETION.md` ä½œæˆ
  - ç§»è¡Œçµ±è¨ˆ
  - ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹å¤‰æ›´ä¸€è¦§
  - ãƒ“ãƒ«ãƒ‰çµæœ
  - å­¦ã‚“ã ã“ã¨
- [ ] `MIGRATION_STATUS.md` æ›´æ–°
- [ ] ã‚³ãƒŸãƒƒãƒˆ

**äºˆæƒ³æ™‚é–“**: 20åˆ†

---

## ğŸ” äºˆæƒ³ã•ã‚Œã‚‹èª²é¡Œ

### èª²é¡Œ1: å…±æœ‰ãƒ•ãƒƒã‚¯ã¸ã®ä¾å­˜

**çŠ¶æ³**: `useCsvUploadArea` ãŒ `@shared/hooks/ui` ã«ä¾å­˜

**å¯¾ç­–**:
- æ—¢ã« `@shared` ã«ç§»è¡Œæ¸ˆã¿ãªã®ã§å•é¡Œãªã—
- ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’ç¢ºèªãƒ»ç¶­æŒ

**ãƒªã‚¹ã‚¯**: ä½

---

### èª²é¡Œ2: CSVå‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¸ã®ä¾å­˜

**çŠ¶æ³**: ãƒ•ãƒƒã‚¯ãŒ `@shared/utils/csvPreview` ãªã©ã«ä¾å­˜

**å¯¾ç­–**:
- æ—¢ã« `@shared` ã«ç§»è¡Œæ¸ˆã¿
- ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ã‚’ç¶­æŒ

**ãƒªã‚¹ã‚¯**: ä½

---

### èª²é¡Œ3: å‹å®šç¾©ã®å…±æœ‰

**çŠ¶æ³**: Databaseå‹ãŒReportæ©Ÿèƒ½ã‹ã‚‰å‚ç…§ã•ã‚Œã‚‹å¯èƒ½æ€§

**å¯¾ç­–**:
- ç¾æ™‚ç‚¹ã§ã¯ç‹¬ç«‹
- å°†æ¥çš„ã«å…±æœ‰ãŒå¿…è¦ãªã‚‰ `@shared/types` ã«ç§»å‹•æ¤œè¨

**ãƒªã‚¹ã‚¯**: ä½

---

## âœ… æ¤œè¨¼è¨ˆç”»

### ãƒ“ãƒ«ãƒ‰æ¤œè¨¼
```bash
npm run build
# æœŸå¾…: ã‚¨ãƒ©ãƒ¼0ä»¶ã€è­¦å‘Šã¯æ—¢çŸ¥ã®ã‚‚ã®ã®ã¿
# ç›®æ¨™: < 10ç§’
```

### å‹ãƒã‚§ãƒƒã‚¯
```bash
npm run type-check  # ã¾ãŸã¯ tsc --noEmit
# æœŸå¾…: ã‚¨ãƒ©ãƒ¼0ä»¶
```

### æ©Ÿèƒ½æ¤œè¨¼
1. ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹: `/database/upload`
2. CSVé¸æŠ/ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
3. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
4. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ
5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

## ğŸ“¦ æœŸå¾…ã•ã‚Œã‚‹æˆæœç‰©

### ã‚³ãƒ¼ãƒ‰
1. `src/features/database/` (å®Œå…¨ãªFSDæ§‹é€ )
2. `src/features/database/index.ts` (å…¬é–‹API)
3. æ›´æ–°ã•ã‚ŒãŸ `pages/database/UploadDatabasePage.tsx`

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
1. `PHASE4_STEP4_COMPLETION.md`
2. æ›´æ–°ã•ã‚ŒãŸ `MIGRATION_STATUS.md`

### çµ±è¨ˆ
- ç§»è¡Œãƒ•ã‚¡ã‚¤ãƒ«æ•°: 8
- ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼æ›´æ–°: 1ãƒ•ã‚¡ã‚¤ãƒ«
- å…¬é–‹API: 6ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (3ãƒ•ãƒƒã‚¯ + 3ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
- æ¨å®šã‚³ãƒ¼ãƒ‰è¡Œæ•°: ~600è¡Œ

---

## ğŸ“ Reportç§»è¡Œã‹ã‚‰ã®å­¦ã³

### é©ç”¨ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

1. **æ®µéšçš„ç§»è¡Œ**:
   - å‹å®šç¾© â†’ ãƒ•ãƒƒã‚¯ â†’ UI ã®é †
   - å„ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ“ãƒ«ãƒ‰ç¢ºèª

2. **ç›¸å¯¾ãƒ‘ã‚¹ vs çµ¶å¯¾ãƒ‘ã‚¹**:
   - åŒä¸€featureå†…: ç›¸å¯¾ãƒ‘ã‚¹
   - ä»–feature/shared: çµ¶å¯¾ãƒ‘ã‚¹

3. **å…¬é–‹API**:
   - å˜ä¸€ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ (`index.ts`)
   - æ˜ç¢ºãªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

4. **ã‚³ãƒŸãƒƒãƒˆæˆ¦ç•¥**:
   - å°ã•ãªè«–ç†çš„å˜ä½ã§ã‚³ãƒŸãƒƒãƒˆ
   - è©³ç´°ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

### Reportç§»è¡Œã¨ã®é•ã„

| é …ç›® | Report | Database |
|------|--------|----------|
| ãƒ•ã‚¡ã‚¤ãƒ«æ•° | 34 | 8 |
| è¤‡é›‘åº¦ | é«˜ (6ã‚¹ãƒ†ãƒƒãƒ—) | ä½ (3ã‚¹ãƒ†ãƒƒãƒ—) |
| ä¾å­˜é–¢ä¿‚ | è¤‡é›‘ | ã‚·ãƒ³ãƒ—ãƒ« |
| äºˆæƒ³æ™‚é–“ | 6æ™‚é–“ | 1.5æ™‚é–“ |

---

## ğŸš€ å®Ÿè¡Œæ‰‹é †

### ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
```bash
git checkout -b phase4/step4-database
```

### Step-by-Stepã‚¬ã‚¤ãƒ‰

#### Step 4-1: å‹å®šç¾©ç§»è¡Œ
```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p src/features/database/model

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
cp src/components/database/types.ts \
   src/features/database/model/database.types.ts

# å…¬é–‹APIä½œæˆ
cat > src/features/database/index.ts << 'EOF'
// Model (Types)
export type {
  // ... types
} from './model/database.types';
EOF

# ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build
```

#### Step 4-2: ãƒ•ãƒƒã‚¯ç§»è¡Œ
```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p src/features/database/hooks

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
cp -r src/hooks/database/* src/features/database/hooks/

# ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ä¿®æ­£
# (ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿæ–½)

# å…¬é–‹APIæ›´æ–°
# (ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿæ–½)

# ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build
```

#### Step 4-3: UIç§»è¡Œ
```bash
# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
mkdir -p src/features/database/ui

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
cp src/components/database/*.tsx src/features/database/ui/

# ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ä¿®æ­£
# (ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿæ–½)

# å…¬é–‹APIæ›´æ–°
# (ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿæ–½)

# ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build
```

#### Step 4-4: ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼æ›´æ–°
```bash
# ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ‘ã‚¹ä¸€æ‹¬ç½®æ›
# @/components/database â†’ @features/database
# @/hooks/database â†’ @features/database

# ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build
```

#### Step 4-5: å®Œäº†å‡¦ç†
```bash
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
# (ã‚¨ãƒ‡ã‚£ã‚¿ã§å®Ÿæ–½)

# ã‚³ãƒŸãƒƒãƒˆ
git add src/features/database docs/phase4/
git commit -m "feat(phase4): complete Step 4 - migrate Database feature to FSD"

# (ã‚ªãƒ—ã‚·ãƒ§ãƒ³) mainã¸ãƒãƒ¼ã‚¸
git checkout main
git merge phase4/step4-database
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

- [PHASE4_STEP3_COMPLETION.md](./PHASE4_STEP3_COMPLETION.md) - Reportç§»è¡Œã®å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ
- [PHASE4_KICKOFF.md](./PHASE4_KICKOFF.md) - Phase 4å…¨ä½“è¨ˆç”»
- [Feature-Sliced Design](https://feature-sliced.design/) - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

## ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ã‚¹ãƒ†ãƒƒãƒ— | äºˆæƒ³æ™‚é–“ | é–‹å§‹äºˆå®š | å®Œäº†äºˆå®š |
|---------|---------|---------|---------|
| Step 4-1 | 10åˆ† | 13:00 | 13:10 |
| Step 4-2 | 20åˆ† | 13:10 | 13:30 |
| Step 4-3 | 20åˆ† | 13:30 | 13:50 |
| Step 4-4 | 10åˆ† | 13:50 | 14:00 |
| Step 4-5 | 20åˆ† | 14:00 | 14:20 |
| **åˆè¨ˆ** | **1.5æ™‚é–“** | **13:00** | **14:20** |

---

## âœï¸ æ‰¿èª

- [ ] ã‚­ãƒƒã‚¯ã‚ªãƒ•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆå®Œäº†
- [ ] å®Ÿæ–½è¨ˆç”»ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†
- [ ] ãƒªã‚¹ã‚¯è©•ä¾¡å®Œäº†
- [ ] å®Ÿè¡Œæº–å‚™å®Œäº†

**ä½œæˆæ—¥**: 2025-01-05  
**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: Step 4-1å®Ÿè¡Œ (å‹å®šç¾©ã®ç§»è¡Œ)

---

**Ready to Start! ğŸš€**

Databaseæ©Ÿèƒ½ã®ç§»è¡Œã¯ã€Reportç§»è¡Œã§ç¢ºç«‹ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨ã—ã€ã‚ˆã‚Šã‚¹ãƒ ãƒ¼ã‚ºã«é€²è¡Œã™ã‚‹è¦‹è¾¼ã¿ã§ã™ã€‚
