###############################################
# .env.common (全環境共通設定)
# - ここにはステージ差分が無い値のみを置く
# - 環境固有の値は .env.<env> 側で override
# - docker-compose の env_file 読み込み順序: .env.common → .env.<env> → secrets/.env.<env>.secrets
# - 読み込み順序により、後から読み込まれるファイルで同じキーが定義されていると上書きされます
###############################################

# === DB 共通 (DB 名は各ステージで上書き) ===
# 注意: これは DB ユーザー分離・パスワード強化対応の一環です
# POSTGRES_USER と POSTGRES_PASSWORD は環境別に secrets/.env.*.secrets で設定してください
POSTGRES_USER=__SET_IN_ENV_SPECIFIC_FILE__
POSTGRES_PASSWORD=__SET_IN_ENV_SPECIFIC_FILE__
POSTGRES_HOST=db
POSTGRES_PORT=5432

# === アプリ基底パス統一 ===
# 新: APP_ROOT_DIR (旧: APP_BASE_DIR, PYTHONPATH と同値)。段階的移行用に互換変数を残す。
APP_ROOT_DIR=/backend
PYTHONPATH=${APP_ROOT_DIR}
APP_BASE_DIR=${APP_ROOT_DIR}

# === Core API / Forecast Worker パス ===
# forecast_worker は /worker をルートとするため個別設定
CORE_API_PYTHONPATH=${APP_ROOT_DIR}
FORECAST_WORKER_PYTHONPATH=/worker

# === ledger_api 共通設定 (subdir 追加時はここ) ===
BASE_ST_APP_DIR=${APP_ROOT_DIR}/app/st_app
LEDGER_SYNC_SUBDIRS=master,templates

# === API Keys / Secrets ===
# 値は基本 docker secret / 環境注入。サンプルとして空のまま。
OPENAI_API_KEY=
GEMINI_API_KEY=

# === Security / Authentication ===
# DEBUG: デバッグモード (True で /docs 等を公開、本番は False 必須)
DEBUG=false
# IAP 設定は各環境ファイルで上書き
IAP_ENABLED=false
IAP_AUDIENCE=
# 許可するメールドメイン (IAP認証時のホワイトリスト)
ALLOWED_EMAIL_DOMAIN=honest-recycle.co.jp
# IAP公開鍵URL (通常は変更不要)
IAP_PUBLIC_KEY_URL=https://www.gstatic.com/iap/verify/public_key

# === Application Settings ===
# アプリケーションのタイムゾーン
APP_TIMEZONE=Asia/Tokyo
TZ=Asia/Tokyo

# === API URLs (External Services) ===
# Gemini API エンドポイント
GEMINI_API_URL=https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent

# === Directory Paths ===
# シークレット格納ディレクトリ
SECRETS_DIR=/backend/secrets
# CSV一時アップロードディレクトリ
CSV_TEMP_DIR=/tmp/csv_uploads
# CSVマスター設定ファイルパス
CSV_MASTERS_YAML_PATH=/backend/config/csv_config/shogun_csv_masters.yaml

# === Upload Limits ===
# CSVアップロード最大サイズ (バイト)
CSV_UPLOAD_MAX_SIZE=10485760

# === CORS Settings ===
# CORS許可オリジン (カンマ区切り、各環境で上書き可能)
CORS_ORIGINS=http://localhost:5173,http://127.0.0.1:5173

# === Core API: Internal API URLs (共通) ===
# 全環境で Docker Compose 内部ネットワーク名を使用
# これらはバックエンドサービス間の内部通信に使用されます
RAG_API_BASE=http://rag_api:8000
LEDGER_API_BASE=http://ledger_api:8000
MANUAL_API_BASE=http://manual_api:8000
AI_API_BASE=http://ai_api:8000

# === Frontend to Backend (フロントエンド → バックエンド通信) ===
# フロントエンドからは相対パス /core_api を使用してください
# Vite dev server が Docker 内部ネットワークを使ってプロキシします
CORE_API_INTERNAL_URL=http://core_api:8000

# === Forecast Worker Settings (共通デフォルト) ===
# ポーリング間隔 (秒)。環境別に上書き可能。
POLL_INTERVAL=5

# === Ledger API Report Artifact Settings ===
# PDF署名用のシークレットキー
# ⚠️ セキュリティ上重要: 本番環境では必ず強力なランダム文字列を設定すること
# 値は secrets/.env.*.secrets ファイルで設定してください
# 例: openssl rand -base64 32
REPORT_ARTIFACT_SECRET=

# === 備考 ===
# ・個別サービス専用変数を追加したい場合は、service 用 .env を増やすより
#   まずは stage ファイル (.env.stg 等) に置く → 再利用が 2 箇所以上になったら common へ昇格。
# ・GCP 認証は Application Default Credentials (ADC) を使用します。
#   - ローカル開発: gcloud auth application-default login
#   - GCE (stg/prod): VM にサービスアカウントをアタッチ
