# TARGET_DATE ãƒ‡ãƒ¼ã‚¿ç¯„å›²ç¢ºèªãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-12-19  
**TARGET_DATE**: 2025-12-17ï¼ˆäºˆæ¸¬å¯¾è±¡æ—¥ï¼‰

## 1. æ¦‚è¦

æ—¥æ¬¡t+1äºˆæ¸¬ã®ãƒ‡ãƒ¼ã‚¿ç¯„å›²ãŒå¦¥å½“ã§ã‚ã‚‹ã“ã¨ã‚’æ¤œè¨¼ã—ã€äºˆæ¸¬ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã—ã¦çµæœã‚’ç¢ºèªã—ãŸã€‚

---

## 2. ãƒ‡ãƒ¼ã‚¿ç¯„å›²ç¢ºèª

### 2-A. å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ï¼ˆå—å…¥ï¼‰

#### æ—¥ä»˜ãƒ¬ãƒ³ã‚¸
```sql
SELECT MIN(slip_date), MAX(slip_date), COUNT(*) FROM stg.v_active_shogun_flash_receive;
```

| min_date   | max_date   | rows  |
|------------|------------|-------|
| 2024-05-01 | 2025-12-16 | 93969 |

#### ãƒªãƒ¼ã‚¯æ¤œæŸ»

| æ¤œæŸ»é …ç›® | SQLæ¡ä»¶ | ä»¶æ•° | åˆ¤å®š |
|----------|---------|------|------|
| TARGET_DATE-1 (2025-12-16) | `slip_date = '2025-12-16'` | **223ä»¶** | âœ… OKï¼ˆå‰æ—¥å®Ÿç¸¾ã‚ã‚Šï¼‰ |
| TARGET_DATE (2025-12-17) | `slip_date = '2025-12-17'` | **0ä»¶** | âœ… OKï¼ˆãƒªãƒ¼ã‚¯ãªã—ï¼‰ |

**çµè«–**: å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã¯ **TARGET_DATE-1ï¼ˆ2025-12-16ï¼‰ã¾ã§** å­˜åœ¨ã—ã€TARGET_DATEå½“æ—¥ã®ãƒ‡ãƒ¼ã‚¿ã¯å«ã¾ã‚Œã¦ã„ãªã„ï¼ˆãƒªãƒ¼ã‚¯ãªã—ï¼‰ã€‚

---

### 2-B. äºˆç´„ãƒ‡ãƒ¼ã‚¿

#### æ—¥ä»˜ãƒ¬ãƒ³ã‚¸
```sql
SELECT MIN(date), MAX(date), COUNT(*) FROM mart.v_reserve_daily_features;
```

| min_date   | max_date   | rows |
|------------|------------|------|
| 2023-01-04 | 2025-12-19 | 992  |

#### TARGET_DATEå½“æ—¥ã®äºˆç´„
```sql
SELECT * FROM mart.v_reserve_daily_features WHERE date = '2025-12-17';
```

| date       | total_customer_count | fixed_customer_count | reserve_trucks |
|------------|---------------------|---------------------|----------------|
| 2025-12-17 | 57                  | 33                  | 83             |

**çµè«–**: TARGET_DATEï¼ˆ2025-12-17ï¼‰ã®äºˆç´„ãƒ‡ãƒ¼ã‚¿ã¯ **1è¡Œå­˜åœ¨**ï¼ˆä¼æ¥­æ•°57ç¤¾ã€å°æ•°83å°ï¼‰ã€‚

---

## 3. è¨­è¨ˆãƒã‚§ãƒƒã‚¯ï¼ˆãƒªãƒ¼ã‚¯ç¢ºèªï¼‰

### ã‚³ãƒ¼ãƒ‰ç¢ºèª: `run_daily_tplus1_forecast.py`

| ãƒ‡ãƒ¼ã‚¿ç¨®åˆ¥ | å–å¾—ç¯„å›² | ã‚³ãƒ¼ãƒ‰ | åˆ¤å®š |
|------------|----------|--------|------|
| å®Ÿç¸¾ | `target_date - 360d` ã€œ `target_date - 1d` | `to_date = target_date - timedelta(days=1)` | âœ… æ˜¨æ—¥ã¾ã§ |
| äºˆç´„ | `target_date` ã€œ `target_date` | `get_reserve_daily(target_date, target_date)` | âœ… å½“æ—¥ã®ã¿ |

**çµè«–**: 
- **t+1äºˆæ¸¬ã®å­¦ç¿’çª“ã¯ã€Œæ˜¨æ—¥ã¾ã§ã€** â†’ ãƒªãƒ¼ã‚¯ãªã—ï¼ˆOKï¼‰
- **äºˆç´„ã¯ã€Œäºˆæ¸¬å¯¾è±¡æ—¥å½“æ—¥ã€** â†’ å½“æ—¥äºˆç´„ã‚’ç‰¹å¾´é‡ã«ä½¿ç”¨ï¼ˆè¨­è¨ˆä¸ŠOKï¼‰
- **å®Ÿç¸¾ã«TARGET_DATEå½“æ—¥ã¯å«ã¾ã‚Œãªã„** â†’ ãƒªãƒ¼ã‚¯ãªã—ï¼ˆOKï¼‰

---

## 4. äºˆæ¸¬ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ

### 4-A. ã‚¸ãƒ§ãƒ–æŠ•å…¥

```sql
INSERT INTO forecast.forecast_jobs (job_type, target_date, status, run_after)
VALUES ('daily_tplus1', '2025-12-17', 'queued', NOW());
```

| é …ç›® | å€¤ |
|------|-----|
| job_id | `069c476d-d2f8-40ae-ac91-372bb3f80063` |
| job_type | `daily_tplus1` |
| target_date | 2025-12-17 |

### 4-B. Worker ãƒ­ã‚°ï¼ˆé‡è¦ãƒã‚¤ãƒ³ãƒˆï¼‰

```
âœ… Claimed job: daily_tplus1 (job_id: 069c476d-d2f8-40ae-ac91-372bb3f80063)
ğŸ“Š Exporting actuals: 2024-06-25 to 2025-12-16  â† æ˜¨æ—¥ã¾ã§ï¼ˆãƒªãƒ¼ã‚¯ãªã—ï¼‰
ğŸ“… Preparing reserve data range: 2024-12-22 to 2025-12-17  â† TARGET_DATEå«ã‚€
ğŸ”„ Running retrain_and_eval:
   --actuals-start-date 2024-06-25
   --actuals-end-date 2025-12-16
   --reserve-start-date 2024-12-22
   --reserve-end-date 2025-12-17
   --start-date 2025-12-17
   --end-date 2025-12-17
```

### 4-C. ã‚¸ãƒ§ãƒ–çµæœ

| job_id | status | target_date | finished_at |
|--------|--------|-------------|-------------|
| `069c476d-d2f8-40ae-ac91-372bb3f80063` | **succeeded** | 2025-12-17 | 2025-12-19 07:02:04 |

---

## 5. äºˆæ¸¬çµæœ

### forecast.daily_forecast_results

| é …ç›® | å€¤ |
|------|-----|
| result_id | `b075a5cc-5182-46dc-8212-4c3a882529ce` |
| target_date | 2025-12-17 |
| p10 | **65,612 kg** |
| p50ï¼ˆä¸­å¤®å€¤ï¼‰ | **86,324 kg** |
| p90 | **107,035 kg** |
| unit | kg |
| generated_at | 2025-12-19 06:55:03 |

### äºˆæ¸¬å€¤ã‚µãƒãƒª

```
äºˆæ¸¬: 2025-12-17ï¼ˆæ°´æ›œæ—¥ï¼‰
  P50ï¼ˆä¸­å¤®å€¤ï¼‰: 86.3ãƒˆãƒ³
  P10ã€œP90ç¯„å›²: 65.6ã€œ107.0ãƒˆãƒ³
```

---

## 6. æœ€çµ‚åˆ¤å®š

| ãƒã‚§ãƒƒã‚¯é …ç›® | çŠ¶æ…‹ |
|--------------|------|
| å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿: TARGET_DATE-1ã¾ã§å­˜åœ¨ | âœ… OK |
| å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿: TARGET_DATEå½“æ—¥ã¯0ä»¶ï¼ˆãƒªãƒ¼ã‚¯ãªã—ï¼‰ | âœ… OK |
| äºˆç´„ãƒ‡ãƒ¼ã‚¿: TARGET_DATEå½“æ—¥ãŒå­˜åœ¨ | âœ… OK |
| ã‚³ãƒ¼ãƒ‰è¨­è¨ˆ: å®Ÿç¸¾ã¯æ˜¨æ—¥ã¾ã§å–å¾— | âœ… OK |
| ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ: succeeded | âœ… OK |
| äºˆæ¸¬çµæœ: DBã«ä¿å­˜æ¸ˆã¿ | âœ… OK |

**çµè«–**: ãƒ‡ãƒ¼ã‚¿ç¯„å›²ã¯å¦¥å½“ã§ã‚ã‚Šã€äºˆæ¸¬ã¯æ­£å¸¸ã«å®Ÿè¡Œãƒ»ä¿å­˜ã•ã‚ŒãŸã€‚
